<#include "../common/_public.html"/>
<link rel="stylesheet" href="${base}/layui/css/layui.css"  media="all">


<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-form layui-card-header layuiadmin-card-header-auto">
            <div class="layui-form-item">

                <div class="layui-inline">
                    <label class="layui-form-label">登录名</label>
                    <div class="layui-input-block">
                        <input type="text" name="loginname" placeholder="请输入" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">角色</label>
                    <div class="layui-input-block">
                        <select name="role">
                            <#-- 做成动态 待完成-->
                            <option value="0">系统管理员</option>
                            <option value="1">VIP用户</option>
                            <option value="2">SIP用户</option>
                            <option value="3">普通用户</option>
                        </select>
                    </div>
                </div>
                <div class="layui-inline">
                    <button class="layui-btn layuiadmin-btn-admin" lay-submit lay-filter="LAY-user-back-search">
                        <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="layui-card-body">
            <div class="layui-card-body">
                <div id="user_home_btu">
                    <button class="layui-btn layui-btn-primary layui-btn-sm" type="button" onclick="openUserView('add')"><i class="layui-icon">&#xe654;</i>新增</button>
                    &nbsp;
                    <#-- onclick="openUserView('edit')"-->
                    <button class="layui-btn layui-btn-sm" onclick="openUserView('edit')" ><i class="layui-icon" >&#xe642;</i>编辑</button>
                    &nbsp;
                    <button class="layui-btn layui-btn-warm layui-btn-sm" onclick="deleteUser()"><i class="layui-icon">&#xe640;</i>删除</button>
                    &nbsp;
                    <button id="refresh" class="layui-btn layui-btn-normal layui-btn-sm refresh"><i class="layui-icon">&#xe669;</i>刷新</button>
                    &nbsp;
                    <button  class="layui-btn  layui-btn-danger layui-btn-sm closed"><i class="layui-icon">&#x1006;</i>关闭</button>
                </div>
                <div class="layui-form">
                    <table class="layui-table" lay-filter="user_table" >
                        <input type="hidden" id="rate_curr" value="20">
                        <thead>
                        <tr>
                            <th style="width: 20px"></th>
                            <th style="text-align:center;vertical-align:middle;">账户</th>
                            <th style="text-align:center;vertical-align:middle;">头像</th>
                            <th style="text-align:center;vertical-align:middle;">昵称</th>
                            <th style="text-align:center;vertical-align:middle;">性别</th>
                            <th style="text-align:center;vertical-align:middle;">生日</th>
                            <th style="text-align:center;vertical-align:middle;">邮箱</th>
                            <th style="text-align:center;vertical-align:middle;">真实姓名</th>
                            <th style="text-align:center;vertical-align:middle;">年龄</th>
                            <th style="text-align:center;vertical-align:middle;">等级</th>
                            <th style="text-align:center;vertical-align:middle;">积分</th>
                        </tr>
                        </thead>
                        <tbody>
                         <#list sysUserlist as sysUser>
                         <tr>
                             <td style="text-align:center;vertical-align:middle;"><input type="checkbox" name="checkbox" lay-skin="primary" value="${sysUser.uId}"></td>
                             <td style="text-align:center;vertical-align:middle;">${sysUser.userName!}</td>
                             <td style="text-align:center;vertical-align:middle;"><img src="${base}/layui/images/avatar/${sysUser.uHeadportrait!'defalut.jpg'}" style="display: inline-block; width: 50px ; height: 50px;"></td>
                             <td style="text-align:center;vertical-align:middle;">${sysUser.uNickname!}</td>
                             <td style="text-align:center;vertical-align:middle;">
                                <#if sysUser.uSex?? >
                                    <#if sysUser.uSex == 0>男</#if>
                                    <#if sysUser.uSex == 1>女</#if>
                                    <#if sysUser.uSex == 2>保密</#if>
                                </#if>
                             </td>
                             <td style="text-align:center;vertical-align:middle;">${(sysUser.uBirthday?string('yyyy-MM-dd'))!}</td>
                             <td style="text-align:center;vertical-align:middle;">${sysUser.uEmail!}</td>
                             <td style="text-align:center;vertical-align:middle;">${sysUser.uName!}</td>
                             <td style="text-align:center;vertical-align:middle;">${sysUser.uAge!}</td>
                             <td style="text-align:center;vertical-align:middle;">${sysUser.uRank!}</td>
                             <td style="text-align:center;vertical-align:middle;">${sysUser.uScore!}
                                 <#--<div id="rate_${sysUser.uScore!}_${sysUser_index}"></div>-->
                             </td>
                         </tr>
                         </#list>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="${base}/layui/layui.js" charset="UTF-8"></script>
<script src="${base}/layui/lay/js/myJs.js" charset="UTF-8"></script>
<script>
    layui.use(['form','table','rate','element','jquery'], function(){
        var form = layui.form,
                table = layui.table,
                rate = layui.rate,
                $=layui.$;

        form.on('click(delete_user)',function () {
            alert("sdadsad");
        })

    });
    function openUserView(type) {
        var url;
        var title;
        if('add' == type){
            url = '${base}/system/user_toAddOrEdit.do?type=add';
            title= '新增用户'
        }
        if('edit' == type){
            var id = layui.$("input:checkbox[name='checkbox']:checked");
            if(id.size() == 1){
                url ='${base}/system/user_toAddOrEdit.do?type=edit&id=' + id.val();
                title= '编辑用户'

            }else{
                layer.msg('请选择一条数据', {
                    icon:2,
                    time: 2000,
                    offset:'70px'
                });
                return;
            }
        }
        layer.open({
            type: 2,
            content: [url, 'no'], //no 去除滚动条
            title: title,
            area: ['400px', '350px'],
            offset:'70px'
        });
    }
    function deleteUser() {

        var id = layui.$("input:checkbox[name='checkbox']:checked");
        if(id.size() != 1){
            layer.msg('请选择一条数据', {
                icon:2,
                time: 2000,
                offset:'70px'
            });
            return;
        }

        layer.confirm('确定要删除吗', {icon: 3, title:'警告', offset:'70px'}, function(index){
                url = '${base}/system/user_delete.do?id=' + id.val();
                layui.$.ajax({
                    url: url,
                    type: 'post',
                    dataType:"json",
                    success:function(result) {
                        if(result.statusCode == 200){
                            layer.msg(result.message,{
                                icon:1,
                                time:1500,
                                offset: '20px'
                            },function () {
                                layui.$("#refresh").click();
                            })
                        }else if(result.statusCode == 300){
                            layer.msg(result.message,{
                                icon:2,
                                time:2000,
                                offset: '20px'
                            });
                        }
                    }
                });
        });
    }

</script>
